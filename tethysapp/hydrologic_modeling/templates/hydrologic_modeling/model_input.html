{% extends "hydrologic_modeling/googlemap.html" %}

{% load staticfiles %}

{% load tethys_gizmos %}




{% block app_navigation %}

    <h3>Inputs for the model </h3>
    <p id="test_para">Prepare the hydrologic model by entering the inputs (in the three steps) below. </p>


  <form id ="inputs"  method="post" action="{% url 'hydrologic_modeling:model_run' %}" enctype="multipart/form-data">
  {% csrf_token %}

    <!--http://stackoverflow.com/questions/29151241/using-bootstrap-collapse-on-radio-buttons-to-show-hide-content-no-js-->
    <!--<input type="radio" name="group1" value="1" data-toggle="collapse" data-parent="#accordion" data-target="#collapseOne" >-->
    <!--<input type="radio" name="group1" value="2" data-toggle="collapse" data-parent="#accordion" data-target="#collapseTwo">-->
    <!--<input type="radio" name="group1" value="3" data-toggle="collapse" data-parent="#accordion" data-target="#collapseThree">-->


    <!--Bootstrap panels (accordion) for clean looking inputs  -->
    <div class="inputs_as_accordion" id="inputs_as_accordion">

        <!--             First Input Section                  -->
        <div class="panel panel-default">
            <div class="panel-heading" data-toggle="collapse" data-target="#generalInputs">
                <h4 class="panel-title">    1. General Inputs    </h4>
            </div>

            <div id="generalInputs" class="panel-collapse collapse in">
                <div class="panel-body">

                      {% gizmo text_input simulation_name %}
                      {% gizmo text_input USGS_gage %}

                      <table style="width:100%">
                              <tr>
                                    <th> {% gizmo date_picker simulation_start_date_picker %} </th>
                                    <th>  {% gizmo date_picker simulation_end_date_picker %} </th>
                              </tr>
                      </table>
                </div>
            </div>

        </div>



        <!--             Second Input Section                  -->
        <div class="panel panel-default">
            <div class="panel-heading" data-toggle="collapse" data-target="#domainInputs">
                <h4 class="panel-title">
                    2. The domain
                </h4>
            </div>
            <div id="domainInputs" class="panel-collapse collapse">
                <div class="panel-body">

                                    <input type="radio"  name="domain_radio" value="1" data-toggle="collapse" data-parent="#accordion" data-target="#specify" checked /> Specify long lat, or draw on map

                                    <div id="specify" class="panel-collapse collapse" >
                                      <br> <strong> OUTLET  </strong>

                                      <table style="width:100%">


                                          <tr>
                                                <th onChange="init()"> {% gizmo text_input outlet_x %} </th>
                                                <th onChange="init()"> {% gizmo text_input outlet_y %} </th>
                                          </tr>

                                        </table>
                                        <br>

                                      <strong> BOUNDING BOX </strong> <br>
                                      <table width="100%">
                                          <tr>
                                                <th> </th>
                                                <th onChange="area_domain()"> {% gizmo text_input box_topY %}</th>
                                                <th> </th>
                                          </tr>
                                          <tr>
                                                <td onChange="area_domain()">{% gizmo text_input box_leftX %}</td>
                                                <td></td>
                                                <td onChange="area_domain()">{% gizmo text_input box_rightX %}</td>
                                          </tr>
                                          <tr>
                                                <td></td>
                                                <td onChange="area_domain()"> {% gizmo text_input box_bottomY %}</td>
                                                <td></td>
                                          </tr>

                                      </table>
                                    </div>

                                    <br><input type="radio" name="domain_radio" value="1" data-toggle="collapse" data-parent="#accordion" data-target="#upload" > Upload shp files or TIF

                                    <div id="upload" class="collapse" >
                                      <table width="20%">
                                          <!--<tr>-->
                                              <!--<th> Outlet </th>-->
                                              <!--<th><input type="file" name="outlet_shp" accept=".shp, .shx, .dbf, .prj, .geojson, .json, .js /*" title=" " multiple/> </th>-->
                                              <!--&lt;!&ndash;<th><input type="submit" name="submit" value="Upload" /> </th>&ndash;&gt;-->
                                          <!--</tr>-->
                                          <form id ="input_shp"  method="post" action="{% url 'hydrologic_modeling:visualize_shp' %}" enctype="multipart/form-data">
                                              <tr>
                                                  <!--<th> Watershed </th>-->
                                                  <th><input type="file" name="watershed_upload"  accept=".shp, .shx, .dbf, .prj, .zip, .tif, .tiff/*" title="&nbsp;" multiple/> </th>
                                              </tr>

                                              <tr>
        <!--<th><input type="submit" name="submit" value="Upload" /> </th>-->
                                                  <!--<th>  </th>-->
                                                  <th> <input type="button" name="input_shp-form" class="btn btn-default" value="OK"></th>
                                              </tr>
                                          </form>
                                       </table>
                                    </div>

                                    <!--Upload geojson-->
                                    <br><input type="radio" name="domain_radio" value="1" data-toggle="collapse" data-parent="#accordion" data-target="#upload_geojson" > Upload geojson files for watershed

                                    <div id="upload_geojson" class="collapse" >
                                      <table width="20%">
                                          <tr>
                                              <!--<th> Outlet </th>-->
                                              <!--<th><input type="file" id="outlet_geojson" accept=" .geojson, .json, .js /*" title=" " /> </th>-->
                                              <!--&lt;!&ndash;<th><input type="submit" name="submit" value="Upload" /> </th>&ndash;&gt;-->
                                          <!--</tr>-->
                                          <tr>
                                              <th> <input type="file" id="watershed_geojson"  accept=" .geojson, .json, .js /*" title="&nbsp;"  /> </th>
                                              <!--<th><input type="submit" name="submit" value="Upload" /> </th>-->
                                          </tr>
                                          <tr>
                                                <th> <p onclick="loadFileAsText()">Click here to Upload </p></th>
                                          </tr>
                                       </table>
                                    </div>


                                    <br><input type="radio" name="domain_radio" value="1" data-toggle="collapse" data-parent="#accordion" data-target="#hs_upload" > Specify Hydroshare Resource ID
                                    <div id="hs_upload" class="collapse" >
                                       <table>
                                          <tr>
                                              <th> Outlet  </th>
                                              <th>{% gizmo text_input outlet_hs %} </th>
                                          </tr>
                                          <tr>
                                              <th> Watershed </th>
                                              <th>{% gizmo text_input bounding_box_hs %} </th>
                                          </tr>
                                       </table>
                                    </div>


                </div>
            </div>
        </div>



        <!--             Third Input Section                  -->
        <div class="panel panel-default">
            <div class="panel-heading" data-toggle="collapse" data-target="#additionalInputs">
                <h4 class="panel-title">
                    3. Additional Inputs
                </h4>
            </div>
            <div id="additionalInputs" class="panel-collapse collapse">
                <div class="panel-body">

                     <table>
                         <tr  onChange="init()">{% gizmo text_input cell_size %} </tr>
                         <tr>{% gizmo text_input timestep %} </tr>
                         <tr> {% gizmo select_input timeseries_source %}</tr>
                         <tr>{% gizmo select_input model_engine %} </tr>
                         <tr> {% gizmo text_input threshold %}</tr>

                     </table>
                </div>
            </div>
        </div>
    </div>


          <a style="color:blue;" data-toggle="collapse" data-target="#download_request_form"> Only interested in hydrologic dataset? Click here! </a> <br>
          <div class="collapse" id="download_request_form">
              <p style="color:red;">Make sure the 'domain', and the 'start and end dates' are correct </p>
              <input type="radio" name="download_choice" value="geospatial"> Download geospatial files <br>
              <input type="radio" name="download_choice" value="soil" > Download geospatial, and soil files<br>
              <input type="radio" name="download_choice" value="forcing" > Download geospatial, and forcing files<br>

          </div>


      <input type="submit" name="input-form" class="btn btn-default" value="Send Request">




  </form>

  <hr>
  <form id ="load_simulation"  method="post" action="{% url 'hydrologic_modeling:model_run' %}" enctype="form-data">
    {% csrf_token %}

        <hr>
          Simulation already prepared? Load the previously saved simulation from the dropdown menu, or enter the HydroShare resource ID containing simulations files.
            {% gizmo select_input simulation_names_list %}

      <a style="color:grey;" data-toggle="collapse" data-target="#hs_res_id_for_model"> Enter HydroShare resource id instead</a>
      <div class="collapse" id="hs_res_id_for_model">{% gizmo text_input existing_sim_res_id %}  </div>


  <input type="submit" name="simulation-load" class="btn btn-default" value="Load simulation" > <!--This line looks pretty useless to me-->
  <input type="hidden" name="load_simulation_name" value= "{{hs_resource_id_created}}">   <!--This too is kinda useless, because hs_resource_id is not know in this html -->

  </form>

<hr>

{% endblock %}





{% block app_content %}

<!--Google map-->

<div id='map-container' class="col-md-8">
    <!-- app intro-->
    <div id='title'>
        <h3 style="color:#0073e6">Input Data Preparation</h3>
        <p style="font-size:100%">
            This application helps prepare a complete model-instance for PyTOPKAPI model simulation, or model-input files for TOPNET or geospatial dataset for a user defined area (within the bounds of supporting data in the continental US).<br>
            <span data-toggle="collapse" data-target="#intro-detail" style="color: green; margin-bottom: 20px"><strong><u>See more details here.</u></strong></span>
        </p>
        <div id="intro-detail" class="collapse" style="background-color:#f2f2f2">
            <p style="font-size:100%">
                <strong>PyTOPKAPI simulation:</strong> terrain slope and aspect. Data are derived from National Elevation Datasets USGS.<br>
                <strong>TOPNET model input:</strong> canopy coverage fraction, canopy height, leaf area index. Data are derived from National Land Cover Dataset.<br>
                <strong>Download geospatial dataset:</strong> Three options: 1) geospatial 2) geospatial+soil dataset (for US only), and 3) geospatial + soil dataset + forcing files (for US only)<br>
            </p>
        </div>
        <p id="prompt">  </p>
    </div>
    <!-- map -->
    <h7>You can draw the research domain and outlet point in the map (Only watershed delineation offerd for non-US area)</h7>


    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">

    <input id="pac-input" style="width: 300px;" class="controls" type="text" placeholder="Search Box">

    <div id="map" style="width:110%; height:800px"></div>
</div>


{%endblock%}


{% block app_actions_override %}
{% endblock %}



{% block scripts %}
{{ block.super }}
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCJVwfz-TJWiZCvLmgYHv2yHYc8vagp7V0&callback=initMap&libraries=drawing,places">
</script>
<script src="{% static 'hydrologic_modeling/js/model_Input.js' %} " type="text/javascript"></script>
{% endblock %}



